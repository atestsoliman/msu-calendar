<link rel="import" href="node_modules/@polymer/polymer/polymer.html" />

<dom-module id="msu-calendar">
    <template>
        <style>
            :host {
                display:block;
            }

            h1 {
                font-size: 16px;
                line-height: 19px;
                margin: 0;
            }
            .meta {
                margin-bottom: 15px;
                font-size: 12px;
                color: #808080;
            }

            a {
                color: currentColor;
            }
        </style>

        <!-- local DOM for your element -->

        <h1>[[eventInfo.title.$t]]</h1>
        <div class="meta">[[formatStartTime(eventInfo)]]</div>
        <p>[[eventInfo.summary.$t]]</p>
        <p><a href="[[getMoreInfoLink(eventInfo.link)]]">Full event details</a></p>
    </template>

    <script>
    // element registration
    Polymer({
        is: "msu-calendar",

      // add properties and methods on the element's prototype
      properties: {
        // declare properties for the element's public API
        event: Number,
        eventInfo: {
            type: Object,
            value: function () { return { title: { $t: '' } }; }
        }
      },
      attached: function() {
          //http://missouristate.info/feeds/calendar.aspx?eventid=91263&alt=json
          var self = this;
          var xhr = new XMLHttpRequest();
          xhr.open("GET", "http://missouristate.info/feeds/calendar.aspx?eventid=" + this.event + "&alt=json", true);
          xhr.onload = function (evt) {
              self.eventInfo = JSON.parse(this.responseText).feed.entry[0];
              console.log(self.eventInfo);
          };
          xhr.send();
      },
      formatStartTime: function (eventInfo) {
          if (!eventInfo.gd$when) {
              return '';
          }
          var startTime = new Date(eventInfo.gd$when[0].startTime);
          return startTime.toDateString();
      },
      getMoreInfoLink: function (links) {
          if (!links || links.length < 1) {
              return '#';
          }

          for (var i = 0; i < links.length; i++) {
              if (links[i].rel === 'alternate' && links[i].type === 'text/html') {
                  return links[i].href;
              }
          }

          return '#';
      }
    });
    </script>
</dom-module>